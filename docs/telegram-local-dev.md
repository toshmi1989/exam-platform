# Подключение к Telegram при локальной разработке

Чтобы открывать Mini App из Telegram с вашего компьютера, нужно «пробросить» локальные порты в интернет. Иначе Telegram не сможет загрузить приложение по `http://localhost:3000`.

## Что нужно

- **Фронт (Next.js)** — порт **3000**
- **API (Express)** — порт **3001** (его вызывает фронт с телефона, поэтому он тоже должен быть доступен по публичному URL)

## Вариант 1: ngrok (удобно)

1. Установите [ngrok](https://ngrok.com/download) и залогиньтесь (`ngrok config add-authtoken YOUR_TOKEN`).

2. Запустите API и фронт:
   ```bash
   # Терминал 1 — API
   cd apps/api && npm run dev

   # Терминал 2 — фронт
   cd apps/web && npm run dev
   ```

3. Запустите **два** туннеля в отдельных терминалах:
   ```bash
   # Терминал 3 — туннель для фронта
   ngrok http 3000

   # Терминал 4 — туннель для API
   ngrok http 3001
   ```

4. В выводе ngrok возьмите **HTTPS-адреса**, например:
   - Фронт: `https://abc123.ngrok-free.app`
   - API: `https://def456.ngrok-free.app`

5. Укажите фронту адрес API (чтобы с телефона запросы шли в ваш туннель, а не в localhost):
   - В `apps/web/.env.local` создайте или отредактируйте:
     ```env
     NEXT_PUBLIC_API_BASE_URL=https://def456.ngrok-free.app
     ```
   - Перезапустите Next.js (`npm run dev` в `apps/web`).

6. В [BotFather](https://t.me/BotFather):
   - Команда **Edit Bot** → ваш бот → **Menu Button** или **Web App** (в зависимости от того, как у вас открывается приложение).
   - Укажите URL Mini App: **HTTPS-адрес фронта** (из шага 4), например `https://abc123.ngrok-free.app`.

7. Откройте бота в Telegram и запустите Mini App — должна открыться ваша локальная версия.

---

## Вариант 2: Один туннель (только фронт)

Если API и фронт подняты на одной машине и вы готовы проксировать запросы через Next.js:

- Пробросьте только порт **3000** (фронт).
- В Next.js настройте rewrites в `next.config.js`, чтобы запросы к `/api/*` уходили на `http://localhost:3001`.
- В приложении используйте относительные пути к API (например `/api`), а не отдельный хост.

Тогда один туннель `ngrok http 3000` и один URL в BotFather достаточно.

---

## Важно

- В BotFather и в приложении используйте только **HTTPS** (ngrok его даёт из коробки).
- При каждом новом запуске ngrok бесплатные URL меняются — нужно заново прописать их в BotFather и в `NEXT_PUBLIC_API_BASE_URL`, затем перезапустить фронт.
- Для продакшена используйте постоянный домен и не полагайтесь на туннель.
